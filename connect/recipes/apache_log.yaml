recipeDefinitionVersionNumber: 1
canonicalName: Apache-Log-Analytics
title: Apache Log Analytics
contributor: engineering@thatdot.com
summary: ''
description: ''
ingestStreams:
- type: FileIngest
  path: $in_file
  format:
    type: CypherLine
    query: >-
      WITH *, text.regexFirstMatch($that, '(\\S+)\\s+\\S+\\s+(\\S+)\\s+\\[(.+)\\]\\s+\"(.*)\\s+(.*)\\s+(.*)\"\\s+([0-9]+)\\s+(\\S+)\\s+\"(.*)\"\\s+\"(.*)\"')
      AS r
      CREATE ({
        sourceIp: r[1],
        user: r[2],
        time: r[3],
        verb: r[4],
        path: r[5],
        httpVersion: r[6],
        status: r[7],
        size: r[8],
        referrer: r[9],
        agent: r[10],
        type: 'log'
      })
standingQueries:
- outputs:
    verb:
      type: CypherQuery
      query: >-
        match (l) where id(l) = $that.data.id
        match (v) where id(v) = idFrom('verb', l.verb)
        create (l)-[:verb]->(v)
        set v.type = 'verb'
        set v.verb = l.verb
        return null
        skip 1
  pattern:
    type: Cypher
    query: match (l) where l.type = 'log' return distinct id(l) as id
    mode: DistinctId
nodeAppearances: []
quickQueries: []
sampleQueries:
- name: Count HTTP GET Requests
  query: match (l)-[rel:verb]->(v)
         where l.type = 'log' and v.type = 'verb' and v.verb = 'GET'
         return count(rel) as get_count
printQueries:
- cypherQuery: match (v) return v limit 1
- cypherQuery: >-
    match (l)-[rel:verb]->(v)
    where l.type = 'log' and v.type = 'verb' and v.verb = 'GET'
    return count(rel) as get_count
- cypherQuery: match (v) where v.type = 'verb' return v
